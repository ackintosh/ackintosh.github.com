<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Ruby | 暁 [stfuawsc]]]></title>
  <link href="http://ackintosh.github.com/blog/categories/ruby/atom.xml" rel="self"/>
  <link href="http://ackintosh.github.com/"/>
  <updated>2013-02-24T16:34:49+09:00</updated>
  <id>http://ackintosh.github.com/</id>
  <author>
    <name><![CDATA[Ackintosh]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[RubyでObserverパターン]]></title>
    <link href="http://ackintosh.github.com/blog/2013/02/03/observer-pattern-in-ruby/"/>
    <updated>2013-02-03T19:11:00+09:00</updated>
    <id>http://ackintosh.github.com/blog/2013/02/03/observer-pattern-in-ruby</id>
    <content type="html"><![CDATA[<h2>Observerパターン メモ</h2>

<p>他のコンポーネントの動きを監視するコンポーネントを作ることが出来る。<br/>
オブジェクト同士を結合させることがないので、スパゲッティにならずにすむ。<br/>
情報を通知するクラスをサブジェクト(Subject)、情報を受け取るクラスをオブザーバ(Observer)と呼ぶ。</p>

<!-- more -->


<h4>gistfile1.rb</h4>

<p>Subject: Employee<br/>
Observer: Payroll, TaxMan<br/>
Subjectの機能をモジュールとして実装。</p>

<h4>gistfile2.rb</h4>

<p>Ruby標準のObservableモジュールを使った場合。</p>

<h4>gistfile3.rb</h4>

<p>Observerをコードブロックで実装した場合。</p>

<p><a href="https://gist.github.com/4701126">https://gist.github.com/4701126</a></p>

<script src="https://gist.github.com/4701126.js"></script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RubyでStrategyパターン]]></title>
    <link href="http://ackintosh.github.com/blog/2012/11/04/strategy-pattern-in-ruby/"/>
    <updated>2012-11-04T17:04:00+09:00</updated>
    <id>http://ackintosh.github.com/blog/2012/11/04/strategy-pattern-in-ruby</id>
    <content type="html"><![CDATA[<h3>Strategyパターン</h3>

<ul>
<li><p>アルゴリズムに多態性を持たせたい場合の、委譲ベースのアプローチ。</p></li>
<li><p>コンテキストとストラテジオブジェクト間のインターフェースに注意して設計する。</p></li>
</ul>


<!-- more -->


<h3>Rubyで書く</h3>

<ul>
<li><p>基底クラスFormatterはoutput_reportメソッドで例外を投げているだけなので、<br/>
この場合、基底クラスを定義せずに書く具象クラスを書いていったほうがRuby的。(ダックタイピング哲学)</p></li>
<li><p>Report#output_reportの引数がオブジェクトの参照なので、データの流れをシンプルにするが、クラス間の結合度が上がってしまっている。<br/>
→必要な引数の数が少なければ、オブジェクトでなくても良い。<br/>
(コンテキスト - ストラテジオブジェクト間のインターフェースの検討)</p></li>
</ul>


<script src="https://gist.github.com/4010809.js?file=gistfile1.rb"></script>


<p></p>

<p>埋め込んだコードが表示されない場合はこちら<br/>
→ <a href="https://gist.github.com/4010809">https://gist.github.com/4010809</a></p>

<h3>コードブロック(Procオブジェクト)を使って書く</h3>

<ul>
<li>コード例のように、ストラテジオブジェクトの実装がシンプルな場合には、ストラテジをコードブロックに置き換えることでシンプル且つRuby的になる。</li>
</ul>


<script src="https://gist.github.com/4010931.js?file=gistfile1.rb"></script>


<p></p>

<p>埋め込んだコードが表示されない場合はこちら<br/>
→ <a href="https://gist.github.com/4010931">https://gist.github.com/4010931</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[RubyでTemplate Methodパターン]]></title>
    <link href="http://ackintosh.github.com/blog/2012/10/24/template-method-pattern-in-ruby/"/>
    <updated>2012-10-24T20:45:00+09:00</updated>
    <id>http://ackintosh.github.com/blog/2012/10/24/template-method-pattern-in-ruby</id>
    <content type="html"><![CDATA[<p>Template Methodパターンは、アルゴリズムに多態性を持たせたい場合に有効。</p>

<p>Rubyは抽象メソッドをサポートしていないので、Reportクラスのoutput_lineメソッドでは例外を投げるようにしている。</p>

<!-- more -->


<p><em>output_start</em> メソッドや <em>output_end</em> メソッドのように、<br/>
<em>Template Methodの具象クラスによってオーバーライドできる非抽象メソッド</em><br/>
を<strong>フックメソッド</strong> という。</p>

<script src="https://gist.github.com/3945597.js?file=gistfile1.rb"></script>


<p></p>

<p>埋め込んだコードが表示されない場合はこちら
→ <a href="https://gist.github.com/3945597">https://gist.github.com/3945597</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Rubyで抽象クラス／メソッド]]></title>
    <link href="http://ackintosh.github.com/blog/2012/10/23/abstract-method-in-ruby/"/>
    <updated>2012-10-23T20:30:00+09:00</updated>
    <id>http://ackintosh.github.com/blog/2012/10/23/abstract-method-in-ruby</id>
    <content type="html"><![CDATA[<p>Rubyは抽象クラス／メソッドをサポートしていない。<br/>
これらは、Rubyの手軽で動的な考え方にそぐわないから。</p>

<!-- more -->


<p>でも、どうしても同様のことを実装したい場合は、例外を投げるだけのメソッドを定義すれば一応可能。</p>

<p>※ 下記のようなコードはダックタイピングの哲学に反するかもしれない。</p>

<p>※ 埋め込んだコードが表示されない場合
こちら→ <a href="https://gist.github.com/3938364">gist: 3938364</a></p>

<script src="https://gist.github.com/3938364.js?file=gistfile1.rb"></script>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[HerokuのWebサーバーをUnicornに変更する]]></title>
    <link href="http://ackintosh.github.com/blog/2012/08/28/using-the-unicorn-in-heroku/"/>
    <updated>2012-08-28T01:34:00+09:00</updated>
    <id>http://ackintosh.github.com/blog/2012/08/28/using-the-unicorn-in-heroku</id>
    <content type="html"><![CDATA[<p>最近PHPネタばかりだったので、頑張ってRailsについて書いてみます。<br/>
RailsではデフォルトでWEBrickが起動しますが、低速なので本番運用には向かないとされています。</p>

<p><a href="http://www.amazon.co.jp/WEB-DB-PRESS-Vol-70-%E6%88%90%E7%94%B0/dp/4774151904">WEB+DB PRESS Vol.70</a><br/>
<img src="https://dl.dropbox.com/u/22083548/octopress/20120827/webdb_vol70.jpeg" alt="WEB+DB PRESS Vol.70" /><br/>
WEB+DB PRESS vol.70でRails高速化としてUnicornが紹介されています。<br/>
普段Railsで開発するときはherokuを使っているので<br/>
herokuでUnicornを使ってみたいと思います。</p>

<!-- more -->


<h2>heroku ps を確認</h2>

<p>まずはherokuで現在使われているWebサーバーを確認します。</p>

<pre><code>$ heroku ps
</code></pre>

<p><img src="https://dl.dropbox.com/u/22083548/octopress/20120827/heroku_ps_thin.png" alt="heroku_ps" /></p>

<p>herokuのデフォルトはthinなのでしょうか？？<br/>
以下、Unicornのインストールを進めていきます。</p>

<h2>Gemfileに追加</h2>

<pre><code>gem 'unicorn'
</code></pre>

<h2>config/unicorn.rbを作成</h2>

<p>とりあえず設定内容は下記にしました。<br/>
詳しいことは勉強中です。すみません。</p>

<pre><code>worker_processes 2
timeout 20
preload_app false
stdout_path "log/unicorn-out.log"
stderr_path "log/unicorn-err.log"
</code></pre>

<h2>Procfileを作成</h2>

<p>Railsのルートディレクトリ直下にProcfileを作成します。</p>

<pre><code>web: bundle exec unicorn -p $PORT -c ./config/unicorn.rb  
</code></pre>

<h2>herokuにpush</h2>

<p>いつものようにherokuにpushします。</p>

<pre><code>$ git push heroku master
</code></pre>

<h2>heroku ps で確認</h2>

<pre><code>$ heroku ps
</code></pre>

<p><img src="https://dl.dropbox.com/u/22083548/octopress/20120827/heroku_ps_unicorn.png" alt="heroku_ps_unicorn" /></p>

<p>bundle exec unicorn …となっていれば成功です。<br/>
heroku psの出力の2行目が</p>

<pre><code>web.1: crashed for…
</code></pre>

<p>になっていたら設定を見なおしてみてください。</p>
]]></content>
  </entry>
  
</feed>
